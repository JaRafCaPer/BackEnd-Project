<!DOCTYPE html>
<html>
<head>
  <title>Product Management</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-5">
    <h1 class="mb-4">Product Management for Seller: {{user.first_name}}</h1>
    <a class="btn btn-success mb-3" href="/api/products/addProducts">Agregar productos</a>
    <p class="mb-3">Showing {{limitPage}} products on this page</p>
    <table class="table">
      <thead class="thead-dark">
        <tr>
          <th>Thumbnail</th>
          <th>Title</th>
          <th>Description</th>
          <th>Price</th>
          <th>Category</th>
          <th>Stock</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {{#each products.products.docs}}
          <tr>
            <td><img src="{{thumbnail}}" alt="{{title}} Thumbnail" width="100" height="100"></td>
            <td>{{title}}</td>
            <td>{{description}}</td>
            <td>{{price}}</td>
            <td>{{category}}</td>
            <td>{{stock}}</td>
            <td>
              <button class="btn btn-danger deleteProductButton" data-product-id="{{_id}}">Delete</button>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
    <div class="mt-3">
      <p>Page {{products.products.page}} of {{products.products.totalPages}}</p>
    </div>
    <nav aria-label="Page navigation" style="max-width: 20%; margin: 0 auto;">
      <ul class="pagination justify-content-center" style="gap: 5px">
        <li class="page-item">
          {{#if productsPrev}}
            <a class="page-link" href="{{productsPrev}}" aria-label="Anterior">
              <span aria-hidden="true">&laquo;</span>
            </a>
          {{/if}}
        </li>
        <li class="page-item">
          {{#if productsNext}}
            <a class="page-link" href="{{productsNext}}" aria-label="Siguiente">
              <span aria-hidden="true">&raquo;</span>
            </a>
          {{/if}}
        </li>
      </ul>
    </nav>
  </div>
</body>
</html>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const deleteButtons = document.querySelectorAll(".deleteProductButton");

  deleteButtons.forEach((button) => {
    button.addEventListener("click", async () => {
      try { 
        const productId = button.getAttribute("data-product-id");

        // Send an AJAX request to delete the product
        const response = await fetch(`/api/products/${productId}`, {
          method: "DELETE",
        });

        if (response.ok) {
          // Product deleted successfully
          alert("Product deleted!");
          redirect("/api/products/listproducts");
          window.location.reload(); // This will refresh the current page
        } else {
          // Handle the error if needed
          alert("Failed to delete the product.");
        }
      } catch (error) {
        console.error("Error:", error);
      }
    });
  });
});
</script>
    <script>
      document.getElementById("form-category").onsubmit = (e) => {
      e.preventDefault(); const data = new
      FormData(document.getElementById("form-category")); const category =
      data.get("category"); const sort = data.get("sort"); if (category && sort)
      { const url = `?query=category,${category}&sort=${sort}`;
      window.location.href = url; } };
    </script>

  </body>
</html>